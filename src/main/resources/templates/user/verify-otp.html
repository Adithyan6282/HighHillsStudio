<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>HighHillsStudio - Verify OTP</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/custom.css}">
  <link rel="stylesheet" th:href="@{/css/bootstrap-icons.css}">

  <script>
    // Countdown timer (5 minutes)
    function startTimer(durationSeconds) {
        const timerDisplay = document.getElementById("otp-timer");
        let remaining = durationSeconds;

        const timer = setInterval(() => {
            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;

            timerDisplay.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;

            if (remaining <= 0) {
                clearInterval(timer);
                timerDisplay.textContent = "OTP expired";
                document.getElementById("verify-btn").disabled = true;
            }

            remaining--;
        }, 1000);
    }

    window.onload = () => startTimer(300); // 5 minutes
  </script>
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- Header Fragment -->
<div th:replace="user/fragments :: mainHeader"></div>

<!-- OTP Verification Form -->
<main class="flex-grow-1 d-flex justify-content-center align-items-center">
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="card-title text-center mb-4">Verify OTP</h3>

            <!-- Display messages -->
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
            <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>

            <!-- OTP Form -->
            <form th:action="@{/users/verify-otp}" th:object="${otpDTO}" method="post">
              <input type="hidden" th:field="*{email}" />

              <div class="mb-3">
                <label class="form-label" th:for="*{otpCode}">Enter OTP</label>
                <input type="text" th:field="*{otpCode}" class="form-control" placeholder="Enter OTP" required>
                <div th:if="${#fields.hasErrors('otpCode')}" class="text-danger" th:errors="*{otpCode}"></div>
              </div>

              <p class="text-center">Time remaining: <span id="otp-timer">05:00</span></p>

              <button type="submit" class="btn btn-dark w-100" id="verify-btn">Verify</button>
            </form>

            <!-- Resend OTP -->
            <form th:action="@{/users/resend-otp}" method="post" class="mt-3 text-center">
              <input type="hidden" name="email" th:value="${otpDTO.email}" />
              <button type="submit" class="btn btn-link">Resend OTP</button>
            </form>

            <!-- Optional: show OTP for testing -->
            <p th:if="${otpCode}" class="text-muted text-center mt-2" th:text="'OTP (for testing): ' + ${otpCode}"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Footer Fragment -->
<footer class="mt-auto">
  <div th:replace="user/fragments :: footer"></div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>

